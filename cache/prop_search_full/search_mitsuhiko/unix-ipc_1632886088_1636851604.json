[{"url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4", "repository_url": "https://api.github.com/repos/mitsuhiko/unix-ipc", "labels_url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4/labels{/name}", "comments_url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4/comments", "events_url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4/events", "html_url": "https://github.com/mitsuhiko/unix-ipc/pull/4", "id": 1052640341, "node_id": "PR_kwDODop7984ue9TV", "number": 4, "title": "Fix fd leaked when sending serialized channel", "user": {"login": "fayalalebrun", "id": 2482295, "node_id": "MDQ6VXNlcjI0ODIyOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2482295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fayalalebrun", "html_url": "https://github.com/fayalalebrun", "followers_url": "https://api.github.com/users/fayalalebrun/followers", "following_url": "https://api.github.com/users/fayalalebrun/following{/other_user}", "gists_url": "https://api.github.com/users/fayalalebrun/gists{/gist_id}", "starred_url": "https://api.github.com/users/fayalalebrun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fayalalebrun/subscriptions", "organizations_url": "https://api.github.com/users/fayalalebrun/orgs", "repos_url": "https://api.github.com/users/fayalalebrun/repos", "events_url": "https://api.github.com/users/fayalalebrun/events{/privacy}", "received_events_url": "https://api.github.com/users/fayalalebrun/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-13T09:35:50Z", "updated_at": "2021-11-13T23:56:57Z", "closed_at": "2021-11-13T23:56:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/mitsuhiko/unix-ipc/pulls/4", "html_url": "https://github.com/mitsuhiko/unix-ipc/pull/4", "diff_url": "https://github.com/mitsuhiko/unix-ipc/pull/4.diff", "patch_url": "https://github.com/mitsuhiko/unix-ipc/pull/4.patch", "merged_at": "2021-11-13T23:56:48Z"}, "body": "Previously, the dead flag was used to prevent a RawChannel's underlying fd to be closed if it had been serialized. This prevented the fd from being closed in between the channel being serialized and its fd being sent through another RawChannel.\r\n\r\nHowever, while this did prevent the fd from becoming invalidated, it also meant that the fd is never closed, causing an fd leak.\r\n\r\nA better solution in this case is to ensure the fd survives until it is sent by making sure the RawChannel is not dropped until after the send function is called. This is achieved by simply passing a reference to the serialize function instead of consuming the RawChannel. The underlying fd can then be closed unconditionally when the RawChannel is dropped.\r\n\r\nFixes #3 ", "reactions": {"url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/mitsuhiko/unix-ipc/issues/4/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]