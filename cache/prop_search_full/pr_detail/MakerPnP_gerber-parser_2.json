{"url": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2", "id": 2106365878, "node_id": "PR_kwDOHkflOc59jJe2", "html_url": "https://github.com/MakerPnP/gerber-parser/pull/2", "diff_url": "https://github.com/MakerPnP/gerber-parser/pull/2.diff", "patch_url": "https://github.com/MakerPnP/gerber-parser/pull/2.patch", "issue_url": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/2", "number": 2, "state": "closed", "locked": false, "title": "Big ass PR", "user": {"login": "paul-fornage", "id": 36117326, "node_id": "MDQ6VXNlcjM2MTE3MzI2", "avatar_url": "https://avatars.githubusercontent.com/u/36117326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paul-fornage", "html_url": "https://github.com/paul-fornage", "followers_url": "https://api.github.com/users/paul-fornage/followers", "following_url": "https://api.github.com/users/paul-fornage/following{/other_user}", "gists_url": "https://api.github.com/users/paul-fornage/gists{/gist_id}", "starred_url": "https://api.github.com/users/paul-fornage/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paul-fornage/subscriptions", "organizations_url": "https://api.github.com/users/paul-fornage/orgs", "repos_url": "https://api.github.com/users/paul-fornage/repos", "events_url": "https://api.github.com/users/paul-fornage/events{/privacy}", "received_events_url": "https://api.github.com/users/paul-fornage/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "There's frankly too much stuff for me to explain here, but the big changes are here:\r\n## Structure changes\r\n - The `commands` vec of `GerberDoc` is now `Result<Command, GerberParseErrorWithContext>` that stores errors without panicking. However, the `to_commands()` impl still returns the same as it would before, filtering out any errors. Likewise, a new impl `get_errors()` returns only the errors, making it easy for the user to just assert it's empty to get the same functionality.\r\n \r\n - Commands for internal value changes (like setting units or defining an aperture) are now added to the command vec while parsing, as well as getting stored internally. As a result, the `to_commands()` impl no longer adds them back because they are already there. I can't tell if this was a design choice to be able to sort aperture definitions or not, but either way, the tests all still passed and those values are still accessible in the `apertures` hash map.\r\n\r\n- The `Regex` objects have been made static so they aren't getting passed as arguments everywhere.\r\n\r\n- Logging is now handled by the [`log` crate](https://docs.rs/log/latest/log/)\r\n\r\n- Added `parse_line()`, which is now just called on every non-empty line from the original `parse_gerber()`. `parse_line()` returns `Result<Command, GerberParserError>` so that there is only one call to `gerber_doc.commands.push()`. `parse_gerber()` will also convert the `GerberParserError` to `GerberParserErrorWithContext` in the case of an error, adding the line contents and number.\r\n\r\n## Feature additions\r\n- 'Image name' has also been added, which saves the name to the `GerberDoc` and treats the command like it were a comment, as it says in the Gerber spec. \r\n\r\n## Feature removals\r\n- Unfortunately, `ObjectAttribute` has been removed to make it compatible with the latest version of `gerber-types`, but if you can show me where that fork including `ObjectAttribute` exists, I can make a PR to `gerber-types` and add it.\r\n\r\n## Error handling / safety\r\nI went a little overboard with this one.\r\n- There are no `.unwraps()`\r\n- There is one `.expect()` for an IO error failing to read from the file. I don't think an error type would help here\r\n- Explicit and contextualized errors and messages\r\n- Fault tolerant, an unsupported or invalid line no longer causes a panic and is just logged with `log::warn()` and saved internally\r\n\r\n## Changes to `component_tests.rs`\r\nI tried to keep these as similar as possible, but for the `assert!()`s I had to wrap the expected values in `Ok()`s as well as some other type changes to reflect the possibility of errors.\r\n\r\n\r\n\r\nIf there's something you don't like, let me know, don't worry about telling me my code is shit if it is. I'm doing this for my own project, and if it doesn't match the direction you had in mind, I'm just happy I didn't have to build this from scratch.", "created_at": "2024-10-03T20:32:17Z", "updated_at": "2024-10-27T04:30:52Z", "closed_at": "2024-10-26T21:58:02Z", "merged_at": "2024-10-26T21:58:02Z", "merge_commit_sha": "02650f2773b6618cc92bc8c181b3e6f5eadda1d9", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2/commits", "review_comments_url": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2/comments", "review_comment_url": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/2/comments", "statuses_url": "https://api.github.com/repos/MakerPnP/gerber-parser/statuses/1b3d29ac4aa6f43d75941e9700156b8c57614d75", "head": {"label": "paul-fornage:main", "ref": "main", "sha": "1b3d29ac4aa6f43d75941e9700156b8c57614d75", "user": {"login": "paul-fornage", "id": 36117326, "node_id": "MDQ6VXNlcjM2MTE3MzI2", "avatar_url": "https://avatars.githubusercontent.com/u/36117326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paul-fornage", "html_url": "https://github.com/paul-fornage", "followers_url": "https://api.github.com/users/paul-fornage/followers", "following_url": "https://api.github.com/users/paul-fornage/following{/other_user}", "gists_url": "https://api.github.com/users/paul-fornage/gists{/gist_id}", "starred_url": "https://api.github.com/users/paul-fornage/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paul-fornage/subscriptions", "organizations_url": "https://api.github.com/users/paul-fornage/orgs", "repos_url": "https://api.github.com/users/paul-fornage/repos", "events_url": "https://api.github.com/users/paul-fornage/events{/privacy}", "received_events_url": "https://api.github.com/users/paul-fornage/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "repo": {"id": 863634538, "node_id": "R_kgDOM3oEag", "name": "gerber-parser", "full_name": "paul-fornage/gerber-parser", "private": false, "owner": {"login": "paul-fornage", "id": 36117326, "node_id": "MDQ6VXNlcjM2MTE3MzI2", "avatar_url": "https://avatars.githubusercontent.com/u/36117326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paul-fornage", "html_url": "https://github.com/paul-fornage", "followers_url": "https://api.github.com/users/paul-fornage/followers", "following_url": "https://api.github.com/users/paul-fornage/following{/other_user}", "gists_url": "https://api.github.com/users/paul-fornage/gists{/gist_id}", "starred_url": "https://api.github.com/users/paul-fornage/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paul-fornage/subscriptions", "organizations_url": "https://api.github.com/users/paul-fornage/orgs", "repos_url": "https://api.github.com/users/paul-fornage/repos", "events_url": "https://api.github.com/users/paul-fornage/events{/privacy}", "received_events_url": "https://api.github.com/users/paul-fornage/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/paul-fornage/gerber-parser", "description": "Simple gerber parser meant to be used in conjuction with the gerber-types crate", "fork": true, "url": "https://api.github.com/repos/paul-fornage/gerber-parser", "forks_url": "https://api.github.com/repos/paul-fornage/gerber-parser/forks", "keys_url": "https://api.github.com/repos/paul-fornage/gerber-parser/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/paul-fornage/gerber-parser/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/paul-fornage/gerber-parser/teams", "hooks_url": "https://api.github.com/repos/paul-fornage/gerber-parser/hooks", "issue_events_url": "https://api.github.com/repos/paul-fornage/gerber-parser/issues/events{/number}", "events_url": "https://api.github.com/repos/paul-fornage/gerber-parser/events", "assignees_url": "https://api.github.com/repos/paul-fornage/gerber-parser/assignees{/user}", "branches_url": "https://api.github.com/repos/paul-fornage/gerber-parser/branches{/branch}", "tags_url": "https://api.github.com/repos/paul-fornage/gerber-parser/tags", "blobs_url": "https://api.github.com/repos/paul-fornage/gerber-parser/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/paul-fornage/gerber-parser/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/paul-fornage/gerber-parser/git/refs{/sha}", "trees_url": "https://api.github.com/repos/paul-fornage/gerber-parser/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/paul-fornage/gerber-parser/statuses/{sha}", "languages_url": "https://api.github.com/repos/paul-fornage/gerber-parser/languages", "stargazers_url": "https://api.github.com/repos/paul-fornage/gerber-parser/stargazers", "contributors_url": "https://api.github.com/repos/paul-fornage/gerber-parser/contributors", "subscribers_url": "https://api.github.com/repos/paul-fornage/gerber-parser/subscribers", "subscription_url": "https://api.github.com/repos/paul-fornage/gerber-parser/subscription", "commits_url": "https://api.github.com/repos/paul-fornage/gerber-parser/commits{/sha}", "git_commits_url": "https://api.github.com/repos/paul-fornage/gerber-parser/git/commits{/sha}", "comments_url": "https://api.github.com/repos/paul-fornage/gerber-parser/comments{/number}", "issue_comment_url": "https://api.github.com/repos/paul-fornage/gerber-parser/issues/comments{/number}", "contents_url": "https://api.github.com/repos/paul-fornage/gerber-parser/contents/{+path}", "compare_url": "https://api.github.com/repos/paul-fornage/gerber-parser/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/paul-fornage/gerber-parser/merges", "archive_url": "https://api.github.com/repos/paul-fornage/gerber-parser/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/paul-fornage/gerber-parser/downloads", "issues_url": "https://api.github.com/repos/paul-fornage/gerber-parser/issues{/number}", "pulls_url": "https://api.github.com/repos/paul-fornage/gerber-parser/pulls{/number}", "milestones_url": "https://api.github.com/repos/paul-fornage/gerber-parser/milestones{/number}", "notifications_url": "https://api.github.com/repos/paul-fornage/gerber-parser/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/paul-fornage/gerber-parser/labels{/name}", "releases_url": "https://api.github.com/repos/paul-fornage/gerber-parser/releases{/id}", "deployments_url": "https://api.github.com/repos/paul-fornage/gerber-parser/deployments", "created_at": "2024-09-26T16:26:03Z", "updated_at": "2025-06-03T12:58:55Z", "pushed_at": "2024-10-04T16:46:24Z", "git_url": "git://github.com/paul-fornage/gerber-parser.git", "ssh_url": "git@github.com:paul-fornage/gerber-parser.git", "clone_url": "https://github.com/paul-fornage/gerber-parser.git", "svn_url": "https://github.com/paul-fornage/gerber-parser", "homepage": "https://docs.rs/gerber_parser/latest/gerber_parser/", "size": 122, "stargazers_count": 0, "watchers_count": 0, "language": "Rust", "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": false, "forks_count": 0, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 0, "license": {"key": "agpl-3.0", "name": "GNU Affero General Public License v3.0", "spdx_id": "AGPL-3.0", "url": "https://api.github.com/licenses/agpl-3.0", "node_id": "MDc6TGljZW5zZTE="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 0, "open_issues": 0, "watchers": 0, "default_branch": "main"}}, "base": {"label": "MakerPnP:main", "ref": "main", "sha": "05b14ea82c238254b8aca4fe18dd023ff0890ace", "user": {"login": "MakerPnP", "id": 174021306, "node_id": "O_kgDOCl9aug", "avatar_url": "https://avatars.githubusercontent.com/u/174021306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MakerPnP", "html_url": "https://github.com/MakerPnP", "followers_url": "https://api.github.com/users/MakerPnP/followers", "following_url": "https://api.github.com/users/MakerPnP/following{/other_user}", "gists_url": "https://api.github.com/users/MakerPnP/gists{/gist_id}", "starred_url": "https://api.github.com/users/MakerPnP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MakerPnP/subscriptions", "organizations_url": "https://api.github.com/users/MakerPnP/orgs", "repos_url": "https://api.github.com/users/MakerPnP/repos", "events_url": "https://api.github.com/users/MakerPnP/events{/privacy}", "received_events_url": "https://api.github.com/users/MakerPnP/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "repo": {"id": 508028217, "node_id": "R_kgDOHkflOQ", "name": "gerber-parser", "full_name": "MakerPnP/gerber-parser", "private": false, "owner": {"login": "MakerPnP", "id": 174021306, "node_id": "O_kgDOCl9aug", "avatar_url": "https://avatars.githubusercontent.com/u/174021306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MakerPnP", "html_url": "https://github.com/MakerPnP", "followers_url": "https://api.github.com/users/MakerPnP/followers", "following_url": "https://api.github.com/users/MakerPnP/following{/other_user}", "gists_url": "https://api.github.com/users/MakerPnP/gists{/gist_id}", "starred_url": "https://api.github.com/users/MakerPnP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MakerPnP/subscriptions", "organizations_url": "https://api.github.com/users/MakerPnP/orgs", "repos_url": "https://api.github.com/users/MakerPnP/repos", "events_url": "https://api.github.com/users/MakerPnP/events{/privacy}", "received_events_url": "https://api.github.com/users/MakerPnP/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/MakerPnP/gerber-parser", "description": "Simple gerber parser meant to be used in conjuction with the gerber-types crate", "fork": false, "url": "https://api.github.com/repos/MakerPnP/gerber-parser", "forks_url": "https://api.github.com/repos/MakerPnP/gerber-parser/forks", "keys_url": "https://api.github.com/repos/MakerPnP/gerber-parser/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/MakerPnP/gerber-parser/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/MakerPnP/gerber-parser/teams", "hooks_url": "https://api.github.com/repos/MakerPnP/gerber-parser/hooks", "issue_events_url": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/events{/number}", "events_url": "https://api.github.com/repos/MakerPnP/gerber-parser/events", "assignees_url": "https://api.github.com/repos/MakerPnP/gerber-parser/assignees{/user}", "branches_url": "https://api.github.com/repos/MakerPnP/gerber-parser/branches{/branch}", "tags_url": "https://api.github.com/repos/MakerPnP/gerber-parser/tags", "blobs_url": "https://api.github.com/repos/MakerPnP/gerber-parser/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/MakerPnP/gerber-parser/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/MakerPnP/gerber-parser/git/refs{/sha}", "trees_url": "https://api.github.com/repos/MakerPnP/gerber-parser/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/MakerPnP/gerber-parser/statuses/{sha}", "languages_url": "https://api.github.com/repos/MakerPnP/gerber-parser/languages", "stargazers_url": "https://api.github.com/repos/MakerPnP/gerber-parser/stargazers", "contributors_url": "https://api.github.com/repos/MakerPnP/gerber-parser/contributors", "subscribers_url": "https://api.github.com/repos/MakerPnP/gerber-parser/subscribers", "subscription_url": "https://api.github.com/repos/MakerPnP/gerber-parser/subscription", "commits_url": "https://api.github.com/repos/MakerPnP/gerber-parser/commits{/sha}", "git_commits_url": "https://api.github.com/repos/MakerPnP/gerber-parser/git/commits{/sha}", "comments_url": "https://api.github.com/repos/MakerPnP/gerber-parser/comments{/number}", "issue_comment_url": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/comments{/number}", "contents_url": "https://api.github.com/repos/MakerPnP/gerber-parser/contents/{+path}", "compare_url": "https://api.github.com/repos/MakerPnP/gerber-parser/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/MakerPnP/gerber-parser/merges", "archive_url": "https://api.github.com/repos/MakerPnP/gerber-parser/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/MakerPnP/gerber-parser/downloads", "issues_url": "https://api.github.com/repos/MakerPnP/gerber-parser/issues{/number}", "pulls_url": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls{/number}", "milestones_url": "https://api.github.com/repos/MakerPnP/gerber-parser/milestones{/number}", "notifications_url": "https://api.github.com/repos/MakerPnP/gerber-parser/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/MakerPnP/gerber-parser/labels{/name}", "releases_url": "https://api.github.com/repos/MakerPnP/gerber-parser/releases{/id}", "deployments_url": "https://api.github.com/repos/MakerPnP/gerber-parser/deployments", "created_at": "2022-06-27T18:56:51Z", "updated_at": "2026-01-08T02:44:10Z", "pushed_at": "2025-12-19T13:47:11Z", "git_url": "git://github.com/MakerPnP/gerber-parser.git", "ssh_url": "git@github.com:MakerPnP/gerber-parser.git", "clone_url": "https://github.com/MakerPnP/gerber-parser.git", "svn_url": "https://github.com/MakerPnP/gerber-parser", "homepage": "https://docs.rs/gerber_parser/latest/gerber_parser/", "size": 373, "stargazers_count": 12, "watchers_count": 12, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": false, "forks_count": 7, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 1, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["gerber", "gerber-files", "parser"], "visibility": "public", "forks": 7, "open_issues": 1, "watchers": 12, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2"}, "html": {"href": "https://github.com/MakerPnP/gerber-parser/pull/2"}, "issue": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/2"}, "comments": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/issues/2/comments"}, "review_comments": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2/comments"}, "review_comment": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/pulls/2/commits"}, "statuses": {"href": "https://api.github.com/repos/MakerPnP/gerber-parser/statuses/1b3d29ac4aa6f43d75941e9700156b8c57614d75"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": true, "mergeable": false, "rebaseable": false, "mergeable_state": "dirty", "merged_by": {"login": "NemoAndrea", "id": 8851596, "node_id": "MDQ6VXNlcjg4NTE1OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8851596?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NemoAndrea", "html_url": "https://github.com/NemoAndrea", "followers_url": "https://api.github.com/users/NemoAndrea/followers", "following_url": "https://api.github.com/users/NemoAndrea/following{/other_user}", "gists_url": "https://api.github.com/users/NemoAndrea/gists{/gist_id}", "starred_url": "https://api.github.com/users/NemoAndrea/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NemoAndrea/subscriptions", "organizations_url": "https://api.github.com/users/NemoAndrea/orgs", "repos_url": "https://api.github.com/users/NemoAndrea/repos", "events_url": "https://api.github.com/users/NemoAndrea/events{/privacy}", "received_events_url": "https://api.github.com/users/NemoAndrea/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "comments": 3, "review_comments": 0, "maintainer_can_modify": false, "commits": 10, "additions": 948, "deletions": 495, "changed_files": 8}