{"url": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251", "id": 756947492, "node_id": "PR_kwDOFUu6YM4tHhok", "html_url": "https://github.com/awslabs/aws-sdk-rust/pull/251", "diff_url": "https://github.com/awslabs/aws-sdk-rust/pull/251.diff", "patch_url": "https://github.com/awslabs/aws-sdk-rust/pull/251.patch", "issue_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/251", "number": 251, "state": "closed", "locked": false, "title": "Implement initial tool for publishing to crates.io", "user": {"login": "jdisanti", "id": 433028, "node_id": "MDQ6VXNlcjQzMzAyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/433028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdisanti", "html_url": "https://github.com/jdisanti", "followers_url": "https://api.github.com/users/jdisanti/followers", "following_url": "https://api.github.com/users/jdisanti/following{/other_user}", "gists_url": "https://api.github.com/users/jdisanti/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdisanti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdisanti/subscriptions", "organizations_url": "https://api.github.com/users/jdisanti/orgs", "repos_url": "https://api.github.com/users/jdisanti/repos", "events_url": "https://api.github.com/users/jdisanti/events{/privacy}", "received_events_url": "https://api.github.com/users/jdisanti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "This is an initial implementation of a tool to publish the SDK to crates.io. It has two subcommands:\r\n\r\n- `fix-manifests`: This is to be run after importing the latest generated code from smithy-rs. It will add versions to all path dependencies for all crates.\r\n- `publish`: This will be run when ready to actually publish to crates.io. It figures out the correct order to publish the crates in, chunks them into batches, and runs them with some throttled concurrency. It currently doesn't retry on failure, but this can be added later.\r\n\r\nI tested everything works correctly except for the final publish, which, can't be tested until we actually publish. Doing a dry-run publish succeeds for the first few crates that don't have any path dependencies.\r\n\r\nSample output of the publish command:\r\n```\r\nOct 12 18:44:08.509  INFO publisher::subcommand::publish: Discovering crates to publish...\r\nOct 12 18:44:09.432  INFO publisher::subcommand::publish: Crates discovered.\r\nPublish plan:\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/protocol-test-helpers\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-async\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-types\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-eventstream\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-sigv4\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-types\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-http\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-http-tower\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-json\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-query\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-xml\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-endpoint\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-auth\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-http\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-client\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-sig-auth\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-hyper\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/sts\"]: cargo publish --dry-run\r\n  wait\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/aws-config\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/accessanalyzer\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/account\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/acm\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/acmpca\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/alexaforbusiness\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/amp\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/amplify\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/amplifybackend\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/apigateway\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/apigatewaymanagement\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/apigatewayv2\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appconfig\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appflow\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appintegrations\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/applicationautoscaling\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/applicationcostprofiler\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/applicationdiscovery\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/applicationinsights\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appmesh\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/apprunner\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appstream\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/appsync\"]: cargo publish --dry-run\r\n  [in \"/home/jdisanti/src/aws-sdk-rust/sdk/athena\"]: cargo publish --dry-run\r\n\r\n... snip ...\r\n\r\nContinuing will publish to crates.io. Do you wish to continue? yes\r\nOct 12 18:44:10.765  INFO publisher::subcommand::publish: Executing `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/protocol-test-helpers\"]: cargo publish --dry-run`...\r\nOct 12 18:44:10.766  INFO publisher::subcommand::publish: Executing `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-async\"]: cargo publish --dry-run`...\r\nOct 12 18:44:10.766  INFO publisher::subcommand::publish: Executing `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-types\"]: cargo publish --dry-run`...\r\nOct 12 18:44:44.273  INFO publisher::subcommand::publish: Success: `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-types\"]: cargo publish --dry-run`\r\nOct 12 18:44:49.941  INFO publisher::subcommand::publish: Success: `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-async\"]: cargo publish --dry-run`\r\nOct 12 18:44:52.607  INFO publisher::subcommand::publish: Success: `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/protocol-test-helpers\"]: cargo publish --dry-run`\r\nOct 12 18:44:52.608  INFO publisher::subcommand::publish: Executing `[in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-eventstream\"]: cargo publish --dry-run`...\r\nError: Cargo publish failed:\r\nPlan: [in \"/home/jdisanti/src/aws-sdk-rust/sdk/smithy-eventstream\"]: cargo publish --dry-run\r\nStatus: exit status: 101\r\nStdout: \r\nStderr:     Updating crates.io index\r\nwarning: manifest has no description, license, license-file, documentation, homepage or repository.\r\nSee https://doc.rust-lang.org/cargo/reference/manifest.html#package-metadata for more info.\r\n   Packaging smithy-eventstream v0.1.0 (/home/jdisanti/src/aws-sdk-rust/sdk/smithy-eventstream)\r\n   Verifying smithy-eventstream v0.1.0 (/home/jdisanti/src/aws-sdk-rust/sdk/smithy-eventstream)\r\nerror: failed to verify package tarball\r\n\r\nCaused by:\r\n  no matching package named `smithy-types` found\r\n  location searched: registry `https://github.com/rust-lang/crates.io-index`\r\n  perhaps you meant: smithy_types\r\n  required by package `smithy-eventstream v0.1.0 (/home/jdisanti/src/aws-sdk-rust/sdk/target/package/smithy-eventstream-0.1.0)`\r\n```\r\n\r\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.\r\n", "created_at": "2021-10-13T02:04:07Z", "updated_at": "2021-10-19T17:43:34Z", "closed_at": "2021-10-18T16:48:50Z", "merged_at": "2021-10-18T16:48:50Z", "merge_commit_sha": "c5d6c8d5ade789884f8199e3ced2763ea7966fbd", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251/commits", "review_comments_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251/comments", "review_comment_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/251/comments", "statuses_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/statuses/7ef6cbe56d1d4ce2e3b90f307fa3f058199f6104", "head": {"label": "jdisanti:publishing-tool", "ref": "publishing-tool", "sha": "7ef6cbe56d1d4ce2e3b90f307fa3f058199f6104", "user": {"login": "jdisanti", "id": 433028, "node_id": "MDQ6VXNlcjQzMzAyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/433028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdisanti", "html_url": "https://github.com/jdisanti", "followers_url": "https://api.github.com/users/jdisanti/followers", "following_url": "https://api.github.com/users/jdisanti/following{/other_user}", "gists_url": "https://api.github.com/users/jdisanti/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdisanti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdisanti/subscriptions", "organizations_url": "https://api.github.com/users/jdisanti/orgs", "repos_url": "https://api.github.com/users/jdisanti/repos", "events_url": "https://api.github.com/users/jdisanti/events{/privacy}", "received_events_url": "https://api.github.com/users/jdisanti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "repo": null}, "base": {"label": "awslabs:main", "ref": "main", "sha": "acfa8b17206870802e0074a0869147cada5550b5", "user": {"login": "awslabs", "id": 3299148, "node_id": "MDEyOk9yZ2FuaXphdGlvbjMyOTkxNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/3299148?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awslabs", "html_url": "https://github.com/awslabs", "followers_url": "https://api.github.com/users/awslabs/followers", "following_url": "https://api.github.com/users/awslabs/following{/other_user}", "gists_url": "https://api.github.com/users/awslabs/gists{/gist_id}", "starred_url": "https://api.github.com/users/awslabs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awslabs/subscriptions", "organizations_url": "https://api.github.com/users/awslabs/orgs", "repos_url": "https://api.github.com/users/awslabs/repos", "events_url": "https://api.github.com/users/awslabs/events{/privacy}", "received_events_url": "https://api.github.com/users/awslabs/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "repo": {"id": 357284448, "node_id": "MDEwOlJlcG9zaXRvcnkzNTcyODQ0NDg=", "name": "aws-sdk-rust", "full_name": "awslabs/aws-sdk-rust", "private": false, "owner": {"login": "awslabs", "id": 3299148, "node_id": "MDEyOk9yZ2FuaXphdGlvbjMyOTkxNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/3299148?v=4", "gravatar_id": "", "url": "https://api.github.com/users/awslabs", "html_url": "https://github.com/awslabs", "followers_url": "https://api.github.com/users/awslabs/followers", "following_url": "https://api.github.com/users/awslabs/following{/other_user}", "gists_url": "https://api.github.com/users/awslabs/gists{/gist_id}", "starred_url": "https://api.github.com/users/awslabs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/awslabs/subscriptions", "organizations_url": "https://api.github.com/users/awslabs/orgs", "repos_url": "https://api.github.com/users/awslabs/repos", "events_url": "https://api.github.com/users/awslabs/events{/privacy}", "received_events_url": "https://api.github.com/users/awslabs/received_events", "type": "Organization", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/awslabs/aws-sdk-rust", "description": "AWS SDK for the Rust Programming Language", "fork": false, "url": "https://api.github.com/repos/awslabs/aws-sdk-rust", "forks_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/forks", "keys_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/teams", "hooks_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/hooks", "issue_events_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/events{/number}", "events_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/events", "assignees_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/assignees{/user}", "branches_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/branches{/branch}", "tags_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/tags", "blobs_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/git/refs{/sha}", "trees_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/statuses/{sha}", "languages_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/languages", "stargazers_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/stargazers", "contributors_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/contributors", "subscribers_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/subscribers", "subscription_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/subscription", "commits_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/commits{/sha}", "git_commits_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/git/commits{/sha}", "comments_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/comments{/number}", "issue_comment_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/comments{/number}", "contents_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/contents/{+path}", "compare_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/merges", "archive_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/downloads", "issues_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues{/number}", "pulls_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls{/number}", "milestones_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/milestones{/number}", "notifications_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/labels{/name}", "releases_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/releases{/id}", "deployments_url": "https://api.github.com/repos/awslabs/aws-sdk-rust/deployments", "created_at": "2021-04-12T17:37:24Z", "updated_at": "2026-01-20T23:30:39Z", "pushed_at": "2026-01-20T23:30:33Z", "git_url": "git://github.com/awslabs/aws-sdk-rust.git", "ssh_url": "git@github.com:awslabs/aws-sdk-rust.git", "clone_url": "https://github.com/awslabs/aws-sdk-rust.git", "svn_url": "https://github.com/awslabs/aws-sdk-rust", "homepage": "https://awslabs.github.io/aws-sdk-rust/", "size": 2637415, "stargazers_count": 3278, "watchers_count": 3278, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": true, "has_discussions": true, "forks_count": 272, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 145, "license": {"key": "apache-2.0", "name": "Apache License 2.0", "spdx_id": "Apache-2.0", "url": "https://api.github.com/licenses/apache-2.0", "node_id": "MDc6TGljZW5zZTI="}, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["aws", "rust"], "visibility": "public", "forks": 272, "open_issues": 145, "watchers": 3278, "default_branch": "main"}}, "_links": {"self": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251"}, "html": {"href": "https://github.com/awslabs/aws-sdk-rust/pull/251"}, "issue": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/251"}, "comments": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/issues/251/comments"}, "review_comments": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251/comments"}, "review_comment": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/pulls/251/commits"}, "statuses": {"href": "https://api.github.com/repos/awslabs/aws-sdk-rust/statuses/7ef6cbe56d1d4ce2e3b90f307fa3f058199f6104"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "rcoh", "id": 492903, "node_id": "MDQ6VXNlcjQ5MjkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/492903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rcoh", "html_url": "https://github.com/rcoh", "followers_url": "https://api.github.com/users/rcoh/followers", "following_url": "https://api.github.com/users/rcoh/following{/other_user}", "gists_url": "https://api.github.com/users/rcoh/gists{/gist_id}", "starred_url": "https://api.github.com/users/rcoh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rcoh/subscriptions", "organizations_url": "https://api.github.com/users/rcoh/orgs", "repos_url": "https://api.github.com/users/rcoh/repos", "events_url": "https://api.github.com/users/rcoh/events{/privacy}", "received_events_url": "https://api.github.com/users/rcoh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "comments": 0, "review_comments": 15, "maintainer_can_modify": false, "commits": 6, "additions": 1164, "deletions": 1, "changed_files": 13}