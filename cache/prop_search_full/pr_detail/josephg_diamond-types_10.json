{"url": "https://api.github.com/repos/josephg/diamond-types/pulls/10", "id": 806281515, "node_id": "PR_kwDOENJXKs4wDuEr", "html_url": "https://github.com/josephg/diamond-types/pull/10", "diff_url": "https://github.com/josephg/diamond-types/pull/10.diff", "patch_url": "https://github.com/josephg/diamond-types/pull/10.patch", "issue_url": "https://api.github.com/repos/josephg/diamond-types/issues/10", "number": 10, "state": "closed", "locked": false, "title": "Shelf implementation", "user": {"login": "nickdbush", "id": 10998201, "node_id": "MDQ6VXNlcjEwOTk4MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/10998201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nickdbush", "html_url": "https://github.com/nickdbush", "followers_url": "https://api.github.com/users/nickdbush/followers", "following_url": "https://api.github.com/users/nickdbush/following{/other_user}", "gists_url": "https://api.github.com/users/nickdbush/gists{/gist_id}", "starred_url": "https://api.github.com/users/nickdbush/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nickdbush/subscriptions", "organizations_url": "https://api.github.com/users/nickdbush/orgs", "repos_url": "https://api.github.com/users/nickdbush/repos", "events_url": "https://api.github.com/users/nickdbush/events{/privacy}", "received_events_url": "https://api.github.com/users/nickdbush/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "An implementation of the Shelf structure from [dglittle/shelf](https://github.com/dglittle/shelf). This version is incompatible with the version by @dglittle as this version uses a different method for resolving conflicts between shelves with the same version. Rather than stringifying to JSON and then comparing the ordering of the strings, this version hashes the value and compares those hashes. This should produce a more deterministic result across architectures and platforms, as the order fields being hashed is well-defined, rather than reliant on the implementation of the stringifier. It also avoids the allocation of a new string for the stringified result.\r\n\r\nI have opted against implementing the Braid API, the \"fancy\" `local_update` and `remote_update` functions, and the `get_change` and `mask` functions on the shelf object. If there's a consensus that they should make it into the library I'm happy to add them.\r\n\r\nThis PR is currently marked as a draft, as it represents the base implementation that uses a fixed `T` for the content of the shelves (which can either be a value of T, or a map of T). So, it's currently on the user of the library to define what exactly this T is (be it a counter, tuple, or single value). Other types have not yet been implemented because merging rules are not defined in the current shelf algorithm (which only allows for version difference, recursive map merging, or finally hashing as a method for merging shelves).\r\n\r\nFor more context on this PR, see the comments of issue #2.", "created_at": "2021-12-20T05:12:14Z", "updated_at": "2022-01-30T01:48:54Z", "closed_at": "2022-01-30T00:41:43Z", "merged_at": "2022-01-30T00:41:43Z", "merge_commit_sha": "b1f3d6a091ffa4172366ae2baa3e46a60c8bf071", "assignee": null, "assignees": [], "requested_reviewers": [], "requested_teams": [], "labels": [], "milestone": null, "draft": false, "commits_url": "https://api.github.com/repos/josephg/diamond-types/pulls/10/commits", "review_comments_url": "https://api.github.com/repos/josephg/diamond-types/pulls/10/comments", "review_comment_url": "https://api.github.com/repos/josephg/diamond-types/pulls/comments{/number}", "comments_url": "https://api.github.com/repos/josephg/diamond-types/issues/10/comments", "statuses_url": "https://api.github.com/repos/josephg/diamond-types/statuses/89bceafa9315d57ed7ec07e861e3c437dbbb5b43", "head": {"label": "nickdbush:master", "ref": "master", "sha": "89bceafa9315d57ed7ec07e861e3c437dbbb5b43", "user": {"login": "nickdbush", "id": 10998201, "node_id": "MDQ6VXNlcjEwOTk4MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/10998201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nickdbush", "html_url": "https://github.com/nickdbush", "followers_url": "https://api.github.com/users/nickdbush/followers", "following_url": "https://api.github.com/users/nickdbush/following{/other_user}", "gists_url": "https://api.github.com/users/nickdbush/gists{/gist_id}", "starred_url": "https://api.github.com/users/nickdbush/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nickdbush/subscriptions", "organizations_url": "https://api.github.com/users/nickdbush/orgs", "repos_url": "https://api.github.com/users/nickdbush/repos", "events_url": "https://api.github.com/users/nickdbush/events{/privacy}", "received_events_url": "https://api.github.com/users/nickdbush/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "repo": null}, "base": {"label": "josephg:master", "ref": "master", "sha": "77ee7e3715e3b69ab12aa4b92ce43cee1915ccb2", "user": {"login": "josephg", "id": 47413, "node_id": "MDQ6VXNlcjQ3NDEz", "avatar_url": "https://avatars.githubusercontent.com/u/47413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephg", "html_url": "https://github.com/josephg", "followers_url": "https://api.github.com/users/josephg/followers", "following_url": "https://api.github.com/users/josephg/following{/other_user}", "gists_url": "https://api.github.com/users/josephg/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephg/subscriptions", "organizations_url": "https://api.github.com/users/josephg/orgs", "repos_url": "https://api.github.com/users/josephg/repos", "events_url": "https://api.github.com/users/josephg/events{/privacy}", "received_events_url": "https://api.github.com/users/josephg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "repo": {"id": 282220330, "node_id": "MDEwOlJlcG9zaXRvcnkyODIyMjAzMzA=", "name": "diamond-types", "full_name": "josephg/diamond-types", "private": false, "owner": {"login": "josephg", "id": 47413, "node_id": "MDQ6VXNlcjQ3NDEz", "avatar_url": "https://avatars.githubusercontent.com/u/47413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephg", "html_url": "https://github.com/josephg", "followers_url": "https://api.github.com/users/josephg/followers", "following_url": "https://api.github.com/users/josephg/following{/other_user}", "gists_url": "https://api.github.com/users/josephg/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephg/subscriptions", "organizations_url": "https://api.github.com/users/josephg/orgs", "repos_url": "https://api.github.com/users/josephg/repos", "events_url": "https://api.github.com/users/josephg/events{/privacy}", "received_events_url": "https://api.github.com/users/josephg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/josephg/diamond-types", "description": "The world's fastest CRDT. WIP.", "fork": false, "url": "https://api.github.com/repos/josephg/diamond-types", "forks_url": "https://api.github.com/repos/josephg/diamond-types/forks", "keys_url": "https://api.github.com/repos/josephg/diamond-types/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/josephg/diamond-types/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/josephg/diamond-types/teams", "hooks_url": "https://api.github.com/repos/josephg/diamond-types/hooks", "issue_events_url": "https://api.github.com/repos/josephg/diamond-types/issues/events{/number}", "events_url": "https://api.github.com/repos/josephg/diamond-types/events", "assignees_url": "https://api.github.com/repos/josephg/diamond-types/assignees{/user}", "branches_url": "https://api.github.com/repos/josephg/diamond-types/branches{/branch}", "tags_url": "https://api.github.com/repos/josephg/diamond-types/tags", "blobs_url": "https://api.github.com/repos/josephg/diamond-types/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/josephg/diamond-types/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/josephg/diamond-types/git/refs{/sha}", "trees_url": "https://api.github.com/repos/josephg/diamond-types/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/josephg/diamond-types/statuses/{sha}", "languages_url": "https://api.github.com/repos/josephg/diamond-types/languages", "stargazers_url": "https://api.github.com/repos/josephg/diamond-types/stargazers", "contributors_url": "https://api.github.com/repos/josephg/diamond-types/contributors", "subscribers_url": "https://api.github.com/repos/josephg/diamond-types/subscribers", "subscription_url": "https://api.github.com/repos/josephg/diamond-types/subscription", "commits_url": "https://api.github.com/repos/josephg/diamond-types/commits{/sha}", "git_commits_url": "https://api.github.com/repos/josephg/diamond-types/git/commits{/sha}", "comments_url": "https://api.github.com/repos/josephg/diamond-types/comments{/number}", "issue_comment_url": "https://api.github.com/repos/josephg/diamond-types/issues/comments{/number}", "contents_url": "https://api.github.com/repos/josephg/diamond-types/contents/{+path}", "compare_url": "https://api.github.com/repos/josephg/diamond-types/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/josephg/diamond-types/merges", "archive_url": "https://api.github.com/repos/josephg/diamond-types/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/josephg/diamond-types/downloads", "issues_url": "https://api.github.com/repos/josephg/diamond-types/issues{/number}", "pulls_url": "https://api.github.com/repos/josephg/diamond-types/pulls{/number}", "milestones_url": "https://api.github.com/repos/josephg/diamond-types/milestones{/number}", "notifications_url": "https://api.github.com/repos/josephg/diamond-types/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/josephg/diamond-types/labels{/name}", "releases_url": "https://api.github.com/repos/josephg/diamond-types/releases{/id}", "deployments_url": "https://api.github.com/repos/josephg/diamond-types/deployments", "created_at": "2020-07-24T12:58:15Z", "updated_at": "2026-01-20T00:20:42Z", "pushed_at": "2025-09-30T07:13:29Z", "git_url": "git://github.com/josephg/diamond-types.git", "ssh_url": "git@github.com:josephg/diamond-types.git", "clone_url": "https://github.com/josephg/diamond-types.git", "svn_url": "https://github.com/josephg/diamond-types", "homepage": "", "size": 18992, "stargazers_count": 1757, "watchers_count": 1757, "language": "Rust", "has_issues": true, "has_projects": true, "has_downloads": true, "has_wiki": true, "has_pages": false, "has_discussions": true, "forks_count": 41, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 16, "license": null, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": ["collaborative-editing", "crdt"], "visibility": "public", "forks": 41, "open_issues": 16, "watchers": 1757, "default_branch": "master"}}, "_links": {"self": {"href": "https://api.github.com/repos/josephg/diamond-types/pulls/10"}, "html": {"href": "https://github.com/josephg/diamond-types/pull/10"}, "issue": {"href": "https://api.github.com/repos/josephg/diamond-types/issues/10"}, "comments": {"href": "https://api.github.com/repos/josephg/diamond-types/issues/10/comments"}, "review_comments": {"href": "https://api.github.com/repos/josephg/diamond-types/pulls/10/comments"}, "review_comment": {"href": "https://api.github.com/repos/josephg/diamond-types/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/josephg/diamond-types/pulls/10/commits"}, "statuses": {"href": "https://api.github.com/repos/josephg/diamond-types/statuses/89bceafa9315d57ed7ec07e861e3c437dbbb5b43"}}, "author_association": "CONTRIBUTOR", "auto_merge": null, "active_lock_reason": null, "merged": true, "mergeable": null, "rebaseable": null, "mergeable_state": "unknown", "merged_by": {"login": "josephg", "id": 47413, "node_id": "MDQ6VXNlcjQ3NDEz", "avatar_url": "https://avatars.githubusercontent.com/u/47413?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephg", "html_url": "https://github.com/josephg", "followers_url": "https://api.github.com/users/josephg/followers", "following_url": "https://api.github.com/users/josephg/following{/other_user}", "gists_url": "https://api.github.com/users/josephg/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephg/subscriptions", "organizations_url": "https://api.github.com/users/josephg/orgs", "repos_url": "https://api.github.com/users/josephg/repos", "events_url": "https://api.github.com/users/josephg/events{/privacy}", "received_events_url": "https://api.github.com/users/josephg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "comments": 7, "review_comments": 0, "maintainer_can_modify": false, "commits": 2, "additions": 260, "deletions": 69, "changed_files": 3}