[{"url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16", "repository_url": "https://api.github.com/repos/DoumanAsh/async-timer", "labels_url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16/labels{/name}", "comments_url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16/comments", "events_url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16/events", "html_url": "https://github.com/DoumanAsh/async-timer/pull/16", "id": 1091314634, "node_id": "PR_kwDOCt4NUs4waIH5", "number": 16, "title": "web: Fix Closure being dropped before timer is done", "user": {"login": "lann", "id": 245734, "node_id": "MDQ6VXNlcjI0NTczNA==", "avatar_url": "https://avatars.githubusercontent.com/u/245734?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lann", "html_url": "https://github.com/lann", "followers_url": "https://api.github.com/users/lann/followers", "following_url": "https://api.github.com/users/lann/following{/other_user}", "gists_url": "https://api.github.com/users/lann/gists{/gist_id}", "starred_url": "https://api.github.com/users/lann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lann/subscriptions", "organizations_url": "https://api.github.com/users/lann/orgs", "repos_url": "https://api.github.com/users/lann/repos", "events_url": "https://api.github.com/users/lann/events{/privacy}", "received_events_url": "https://api.github.com/users/lann/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-12-30T21:37:49Z", "updated_at": "2021-12-31T20:32:48Z", "closed_at": "2021-12-31T10:51:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/DoumanAsh/async-timer/pulls/16", "html_url": "https://github.com/DoumanAsh/async-timer/pull/16", "diff_url": "https://github.com/DoumanAsh/async-timer/pull/16.diff", "patch_url": "https://github.com/DoumanAsh/async-timer/pull/16.patch", "merged_at": "2021-12-31T10:51:48Z"}, "body": "I was hitting a panic \"closure invoked recursively or destroyed already\" due to the Closure getting dropped before the timer fired, which invalidates the JS function that `setTimeout` is holding. This PR ties the Closure's lifetime to the `web::TimerHandler` which should prevent it from being dropped too early.\r\n\r\nFrom the wasm_bindgen docs:\r\nhttps://rustwasm.github.io/wasm-bindgen/api/wasm_bindgen/closure/struct.Closure.html\r\n\r\n> This type is a \u201chandle\u201d in the sense that whenever it is dropped it will invalidate the JS closure that it refers to. Any usage of the closure in JS after the Closure has been dropped will raise an exception. It\u2019s then up to you to arrange for Closure to be properly deallocate at an appropriate location in your program.\r\n", "reactions": {"url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/DoumanAsh/async-timer/issues/16/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]