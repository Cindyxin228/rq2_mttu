[{"url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121", "repository_url": "https://api.github.com/repos/alexheretic/glyph-brush", "labels_url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121/labels{/name}", "comments_url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121/comments", "events_url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121/events", "html_url": "https://github.com/alexheretic/glyph-brush/pull/121", "id": 704888321, "node_id": "MDExOlB1bGxSZXF1ZXN0NDg5NzMxMjQz", "number": 121, "title": "Draw-cache: Optimise empty cache-queued into single texture upload", "user": {"login": "alexheretic", "id": 2331607, "node_id": "MDQ6VXNlcjIzMzE2MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2331607?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexheretic", "html_url": "https://github.com/alexheretic", "followers_url": "https://api.github.com/users/alexheretic/followers", "following_url": "https://api.github.com/users/alexheretic/following{/other_user}", "gists_url": "https://api.github.com/users/alexheretic/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexheretic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexheretic/subscriptions", "organizations_url": "https://api.github.com/users/alexheretic/orgs", "repos_url": "https://api.github.com/users/alexheretic/repos", "events_url": "https://api.github.com/users/alexheretic/events{/privacy}", "received_events_url": "https://api.github.com/users/alexheretic/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-19T14:04:20Z", "updated_at": "2020-09-26T18:26:33Z", "closed_at": "2020-09-26T10:49:30Z", "author_association": "OWNER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/alexheretic/glyph-brush/pulls/121", "html_url": "https://github.com/alexheretic/glyph-brush/pull/121", "diff_url": "https://github.com/alexheretic/glyph-brush/pull/121.diff", "patch_url": "https://github.com/alexheretic/glyph-brush/pull/121.patch", "merged_at": "2020-09-26T10:49:30Z"}, "body": "This PR adds an optimisation targeting whenever the cache is empty & multiple new glyphs have been drawn in a call to `cache_queued`, e.g. the initial population of the cache & when it must be re-orded to fit all glyphs after a change.\r\n\r\nIn this case total in-use region of the texture will be saved in memory during the `cache_queued(self, fonts, uploader)` call and provided with a single callback to `uploader`. This minimises uploads to the gpu in common cases which should be faster.\r\n\r\n`cache_queued` calls to a non-empty cache are not effected.\r\n\r\n### Benchmarks\r\nThe draw-cache v2 benchmarks simulate gpu uploads by busy waiting for 4us, this allows us to benchmark this improvement in a artificial way.\r\n\r\nNon-populating benchmarks were not effected, as expected. Populating & reordering benchmarks were:\r\n* `multi_font_population_v2` **-63.5%**\r\n* `resizing_v2` **-59.1%**\r\n* `moving_text_thrashing_v2` **-58.3%**\r\n\r\nRelated to discussion in #120 ", "reactions": {"url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/alexheretic/glyph-brush/issues/121/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]