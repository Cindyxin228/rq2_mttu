[{"url": "https://api.github.com/repos/rwf2/Rocket/issues/1618", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1618/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1618/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1618/events", "html_url": "https://github.com/rwf2/Rocket/pull/1618", "id": 868203138, "node_id": "MDExOlB1bGxSZXF1ZXN0NjIzNzY0ODc0", "number": 1618, "title": "Initialize synchronous database pools inside of `spawn_blocking`.", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-26T21:05:59Z", "updated_at": "2021-04-28T03:56:14Z", "closed_at": "2021-04-28T02:32:38Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1618", "html_url": "https://github.com/rwf2/Rocket/pull/1618", "diff_url": "https://github.com/rwf2/Rocket/pull/1618.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1618.patch", "merged_at": "2021-04-28T02:32:38Z"}, "body": "One situation where this is noticeable is when initialization failure\r\nleads to `Drop`; unlike in a successful initialization, `postgres`\r\ndetects and panics when `Drop` is called from within asynchronous code.\r\nSeveral other database pools do not panic in this same situation, but\r\nwould still block the current thread.\r\n\r\nAlso sets the minimum version of `tokio` to 1.4 in `rocket_contrib`,\r\nwhich is the version where `Handle::block_on` (used in `Drop` impls) was\r\nintroduced.\r\n\r\nFixes #1610.\r\n\r\n---\r\n\r\nThis should be reviewed closely, since there have been several bugs and regressions in this area. The goal is thus:\r\n\r\nSynchronous database pool and connection usage, *including* creation, usage, and `Drop`, should always be done inside some kind of \"blocking-safe\" environment. Since #1375 databases use `spawn_blocking`; alternatives include `block_in_place` (risky) or a dedicated thread with message passing to communicate between the async and sync code (safer, but probably not better than the status quo in terms of complexity to implement maintain or troubleshoot and likely still pretty bad ergonomically).\r\n\r\nThis problem is now addressed by starting the database pool inside a `spawn_blocking` closure. Usage of the database pool (i.e. acquiring connections) was already wrapped, along with usage of the connections themselves. This leaves `Drop`, which was also already wrapped properly -- aside from a race condition between server shutdown and handlers that were still running, which was recently fixed in e1307dd.", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1618/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1618/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1528", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1528/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1528/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1528/events", "html_url": "https://github.com/rwf2/Rocket/pull/1528", "id": 802421096, "node_id": "MDExOlB1bGxSZXF1ZXN0NTY4NTY3MDY0", "number": 1528, "title": "update 'postgres' to 0.19 in rocket_contrib", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-02-05T19:33:19Z", "updated_at": "2021-03-01T01:15:49Z", "closed_at": "2021-03-01T01:15:45Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1528", "html_url": "https://github.com/rwf2/Rocket/pull/1528", "diff_url": "https://github.com/rwf2/Rocket/pull/1528.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1528.patch", "merged_at": "2021-03-01T01:15:45Z"}, "body": "Closes #1527.", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1528/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1502", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1502/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1502/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1502/events", "html_url": "https://github.com/rwf2/Rocket/pull/1502", "id": 777180787, "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ3NTQxODk3", "number": 1502, "title": "Enable std feature for indexmap", "user": {"login": "yungkneez", "id": 58558962, "node_id": "MDQ6VXNlcjU4NTU4OTYy", "avatar_url": "https://avatars.githubusercontent.com/u/58558962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yungkneez", "html_url": "https://github.com/yungkneez", "followers_url": "https://api.github.com/users/yungkneez/followers", "following_url": "https://api.github.com/users/yungkneez/following{/other_user}", "gists_url": "https://api.github.com/users/yungkneez/gists{/gist_id}", "starred_url": "https://api.github.com/users/yungkneez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yungkneez/subscriptions", "organizations_url": "https://api.github.com/users/yungkneez/orgs", "repos_url": "https://api.github.com/users/yungkneez/repos", "events_url": "https://api.github.com/users/yungkneez/events{/privacy}", "received_events_url": "https://api.github.com/users/yungkneez/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-01T02:38:04Z", "updated_at": "2021-01-13T22:39:19Z", "closed_at": "2021-01-13T22:39:19Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1502", "html_url": "https://github.com/rwf2/Rocket/pull/1502", "diff_url": "https://github.com/rwf2/Rocket/pull/1502.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1502.patch", "merged_at": "2021-01-13T22:39:19Z"}, "body": "Fixes #1501 ", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1502/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1502/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1500", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1500/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1500/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1500/events", "html_url": "https://github.com/rwf2/Rocket/pull/1500", "id": 776596776, "node_id": "MDExOlB1bGxSZXF1ZXN0NTQ3MDU1Mjgw", "number": 1500, "title": "Update dependencies for tokio 1.0", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-12-30T19:07:43Z", "updated_at": "2021-01-17T21:20:29Z", "closed_at": "2021-01-13T23:22:17Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1500", "html_url": "https://github.com/rwf2/Rocket/pull/1500", "diff_url": "https://github.com/rwf2/Rocket/pull/1500.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1500.patch", "merged_at": "2021-01-13T23:22:17Z"}, "body": "Closes #1451.\r\n\r\nIt might be nice to switch some code to use [`tokio_util::io::ReaderStream`](https://docs.rs/tokio-util/0.6.0/tokio_util/io/struct.ReaderStream.html) and [`tokio_util::io::StreamReader`](https://docs.rs/tokio-util/0.6.0/tokio_util/io/struct.StreamReader.html) now instead of the implementations here, but I would rather do that part separately.\r\n\r\nPossible blocker: support in multipart library", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1500/reactions", "total_count": 14, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 10, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1500/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1467", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1467/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1467/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1467/events", "html_url": "https://github.com/rwf2/Rocket/pull/1467", "id": 736598186, "node_id": "MDExOlB1bGxSZXF1ZXN0NTE1NzgyNzg4", "number": 1467, "title": "Drop synchronous connection pools on a blocking task.", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-11-05T04:19:58Z", "updated_at": "2020-11-23T01:03:43Z", "closed_at": "2020-11-05T22:44:07Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1467", "html_url": "https://github.com/rwf2/Rocket/pull/1467", "diff_url": "https://github.com/rwf2/Rocket/pull/1467.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1467.patch", "merged_at": "2020-11-05T22:44:07Z"}, "body": "This was already done for the connections, but some connection pools might also do synchronous/blocking work on Drop. In particular, dropping a `Runtime` explicitly checks for this situation and panics.\r\n\r\nFixes #1466.", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1467/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1467/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1378", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1378/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1378/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1378/events", "html_url": "https://github.com/rwf2/Rocket/pull/1378", "id": 660188674, "node_id": "MDExOlB1bGxSZXF1ZXN0NDUxOTY3MDQ4", "number": 1378, "title": "Upgrade (almost) all dependencies", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 763868037, "node_id": "MDU6TGFiZWw3NjM4NjgwMzc=", "url": "https://api.github.com/repos/rwf2/Rocket/labels/pr:%20merged", "name": "pr: merged", "color": "5319E7", "default": false, "description": "This pull request was merged manually."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-18T14:43:08Z", "updated_at": "2020-07-22T20:07:00Z", "closed_at": "2020-07-21T17:54:08Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1378", "html_url": "https://github.com/rwf2/Rocket/pull/1378", "diff_url": "https://github.com/rwf2/Rocket/pull/1378.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1378.patch", "merged_at": "2020-07-21T17:54:08Z"}, "body": "Includes a modified version of #1349.\r\nFixes #1341.\r\nCC #1189.\r\n\r\nThis PR upgrades all direct dependencies except `toml` and `pear` (see #1353). It reduces the overall number of packages in `Cargo.lock` from 466 to 390 by my count.\r\n\r\n* Removes `rusted_cypher`. It has a few old dependencies including hyper 0.10 and appears to be unmaintained for a few years now.\r\n* Removes `mongodb`. The latest version of `mongodb` has `async`/`await` support and its own connection pooling, making it doubly unsuitable for the current implementation of `#[database]`.", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1378/reactions", "total_count": 6, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 4, "rocket": 2, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1378/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1342", "repository_url": "https://api.github.com/repos/rwf2/Rocket", "labels_url": "https://api.github.com/repos/rwf2/Rocket/issues/1342/labels{/name}", "comments_url": "https://api.github.com/repos/rwf2/Rocket/issues/1342/comments", "events_url": "https://api.github.com/repos/rwf2/Rocket/issues/1342/events", "html_url": "https://github.com/rwf2/Rocket/pull/1342", "id": 638384394, "node_id": "MDExOlB1bGxSZXF1ZXN0NDM0MTY4NDIw", "number": 1342, "title": "Async: on_attach fairings", "user": {"login": "jebrosen", "id": 7102588, "node_id": "MDQ6VXNlcjcxMDI1ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/7102588?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jebrosen", "html_url": "https://github.com/jebrosen", "followers_url": "https://api.github.com/users/jebrosen/followers", "following_url": "https://api.github.com/users/jebrosen/following{/other_user}", "gists_url": "https://api.github.com/users/jebrosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jebrosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jebrosen/subscriptions", "organizations_url": "https://api.github.com/users/jebrosen/orgs", "repos_url": "https://api.github.com/users/jebrosen/repos", "events_url": "https://api.github.com/users/jebrosen/events{/privacy}", "received_events_url": "https://api.github.com/users/jebrosen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 763868037, "node_id": "MDU6TGFiZWw3NjM4NjgwMzc=", "url": "https://api.github.com/repos/rwf2/Rocket/labels/pr:%20merged", "name": "pr: merged", "color": "5319E7", "default": false, "description": "This pull request was merged manually."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-14T16:24:44Z", "updated_at": "2020-06-23T00:22:00Z", "closed_at": "2020-06-15T00:58:13Z", "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/rwf2/Rocket/pulls/1342", "html_url": "https://github.com/rwf2/Rocket/pull/1342", "diff_url": "https://github.com/rwf2/Rocket/pull/1342.diff", "patch_url": "https://github.com/rwf2/Rocket/pull/1342.patch", "merged_at": "2020-06-15T00:58:13Z"}, "body": "Supersedes #1242 - opening as a new PR so I can do a thorough review on a clean slate.\r\nReviews and comments on that PR have already been addressed and included; this is identical plus/minus commit reorganization and a few docs/strings.", "reactions": {"url": "https://api.github.com/repos/rwf2/Rocket/issues/1342/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rwf2/Rocket/issues/1342/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]