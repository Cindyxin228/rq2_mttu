[{"url": "https://api.github.com/repos/Actyx/banyan/issues/110", "repository_url": "https://api.github.com/repos/Actyx/banyan", "labels_url": "https://api.github.com/repos/Actyx/banyan/issues/110/labels{/name}", "comments_url": "https://api.github.com/repos/Actyx/banyan/issues/110/comments", "events_url": "https://api.github.com/repos/Actyx/banyan/issues/110/events", "html_url": "https://github.com/Actyx/banyan/pull/110", "id": 946220732, "node_id": "MDExOlB1bGxSZXF1ZXN0NjkxNDI4NDM4", "number": 110, "title": "Add optional block cache layer", "user": {"login": "rklaehn", "id": 248257, "node_id": "MDQ6VXNlcjI0ODI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/248257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rklaehn", "html_url": "https://github.com/rklaehn", "followers_url": "https://api.github.com/users/rklaehn/followers", "following_url": "https://api.github.com/users/rklaehn/following{/other_user}", "gists_url": "https://api.github.com/users/rklaehn/gists{/gist_id}", "starred_url": "https://api.github.com/users/rklaehn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rklaehn/subscriptions", "organizations_url": "https://api.github.com/users/rklaehn/orgs", "repos_url": "https://api.github.com/users/rklaehn/repos", "events_url": "https://api.github.com/users/rklaehn/events{/privacy}", "received_events_url": "https://api.github.com/users/rklaehn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-07-16T11:48:45Z", "updated_at": "2021-07-19T07:57:52Z", "closed_at": "2021-07-16T13:04:59Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/Actyx/banyan/pulls/110", "html_url": "https://github.com/Actyx/banyan/pull/110", "diff_url": "https://github.com/Actyx/banyan/pull/110.diff", "patch_url": "https://github.com/Actyx/banyan/pull/110.patch", "merged_at": "2021-07-16T13:04:59Z"}, "body": "The only new addition is the MemCache, the rest is just moving stuff around.", "reactions": {"url": "https://api.github.com/repos/Actyx/banyan/issues/110/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Actyx/banyan/issues/110/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/Actyx/banyan/issues/109", "repository_url": "https://api.github.com/repos/Actyx/banyan", "labels_url": "https://api.github.com/repos/Actyx/banyan/issues/109/labels{/name}", "comments_url": "https://api.github.com/repos/Actyx/banyan/issues/109/comments", "events_url": "https://api.github.com/repos/Actyx/banyan/issues/109/events", "html_url": "https://github.com/Actyx/banyan/pull/109", "id": 944128344, "node_id": "MDExOlB1bGxSZXF1ZXN0Njg5NjU2MDc1", "number": 109, "title": "Add optional prometheus metrics", "user": {"login": "rklaehn", "id": 248257, "node_id": "MDQ6VXNlcjI0ODI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/248257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rklaehn", "html_url": "https://github.com/rklaehn", "followers_url": "https://api.github.com/users/rklaehn/followers", "following_url": "https://api.github.com/users/rklaehn/following{/other_user}", "gists_url": "https://api.github.com/users/rklaehn/gists{/gist_id}", "starred_url": "https://api.github.com/users/rklaehn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rklaehn/subscriptions", "organizations_url": "https://api.github.com/users/rklaehn/orgs", "repos_url": "https://api.github.com/users/rklaehn/repos", "events_url": "https://api.github.com/users/rklaehn/events{/privacy}", "received_events_url": "https://api.github.com/users/rklaehn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-07-14T07:21:49Z", "updated_at": "2021-07-16T08:52:20Z", "closed_at": "2021-07-14T14:31:18Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/Actyx/banyan/pulls/109", "html_url": "https://github.com/Actyx/banyan/pull/109", "diff_url": "https://github.com/Actyx/banyan/pull/109.diff", "patch_url": "https://github.com/Actyx/banyan/pull/109.patch", "merged_at": "2021-07-14T14:31:18Z"}, "body": "I had a hard time figuring out a set of metrics that is not overwhelming, but this seems to work reasonably well. It is not very fine grained, but it gives you a rough idea what the thing is doing overall.\r\n\r\nE.g. this is what you get when running the pond integration test with 8 local linux hosts yields the following metrics (dumping more frequently so I see them):\r\n\r\n```\r\nAX_CI_HOSTS=8linux.yaml npm test pond | grep -A 300 got_metrics | grep -A 1 time_sum\r\n\r\n...\r\n\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_block_get_time_sum 11.24307093500005\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_block_get_time_count 48033\r\n--\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_block_put_time_sum 1.7594724890000006\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_block_put_time_count 1559\r\n--\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_branch_load_time_sum 2.9276649789999785\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_branch_load_time_count 8291\r\n--\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_branch_store_time_sum 1.3235776810000015\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_branch_store_time_count 1037\r\n--\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_leaf_load_time_sum 5.6611070490000515\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_leaf_load_time_count 34957\r\n--\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_leaf_store_time_sum 0.6494339429999996\r\n2021-07-14T07:17:13.669Z node local-linux-8 Actyx stdout: banyan_leaf_store_time_count 522\r\n```\r\n\r\nso it spends most of the db time getting blocks, and focused on banyan it spends most of the time loading leafs (this metric is the total time including decryption, decompression and decoding).\r\n\r\nWe are not going to optimize things just now, but if we wanted to this would give us a good idea where to start.", "reactions": {"url": "https://api.github.com/repos/Actyx/banyan/issues/109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Actyx/banyan/issues/109/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/Actyx/banyan/issues/108", "repository_url": "https://api.github.com/repos/Actyx/banyan", "labels_url": "https://api.github.com/repos/Actyx/banyan/issues/108/labels{/name}", "comments_url": "https://api.github.com/repos/Actyx/banyan/issues/108/comments", "events_url": "https://api.github.com/repos/Actyx/banyan/issues/108/events", "html_url": "https://github.com/Actyx/banyan/pull/108", "id": 942953021, "node_id": "MDExOlB1bGxSZXF1ZXN0Njg4NjI5OTIw", "number": 108, "title": "Zstd update", "user": {"login": "rklaehn", "id": 248257, "node_id": "MDQ6VXNlcjI0ODI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/248257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rklaehn", "html_url": "https://github.com/rklaehn", "followers_url": "https://api.github.com/users/rklaehn/followers", "following_url": "https://api.github.com/users/rklaehn/following{/other_user}", "gists_url": "https://api.github.com/users/rklaehn/gists{/gist_id}", "starred_url": "https://api.github.com/users/rklaehn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rklaehn/subscriptions", "organizations_url": "https://api.github.com/users/rklaehn/orgs", "repos_url": "https://api.github.com/users/rklaehn/repos", "events_url": "https://api.github.com/users/rklaehn/events{/privacy}", "received_events_url": "https://api.github.com/users/rklaehn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-07-13T08:14:16Z", "updated_at": "2021-07-13T09:57:27Z", "closed_at": "2021-07-13T09:57:24Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/Actyx/banyan/pulls/108", "html_url": "https://github.com/Actyx/banyan/pull/108", "diff_url": "https://github.com/Actyx/banyan/pull/108.diff", "patch_url": "https://github.com/Actyx/banyan/pull/108.patch", "merged_at": "2021-07-13T09:57:24Z"}, "body": "Update zstd to 0.9 and rewrite decompress_and_transform to take advantage of Decompressor::upper_bound\r\n\r\nNote that this is the only thing we use the experimental feature for, but the upper_bound functionality itself is not experimental. It translates to the https://zstd.docsforge.com/dev/api/ZSTD_decompressBound/ fn, which is not experimental.", "reactions": {"url": "https://api.github.com/repos/Actyx/banyan/issues/108/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Actyx/banyan/issues/108/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]