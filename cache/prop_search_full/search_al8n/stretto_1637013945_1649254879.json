[{"url": "https://api.github.com/repos/al8n/stretto/issues/11", "repository_url": "https://api.github.com/repos/al8n/stretto", "labels_url": "https://api.github.com/repos/al8n/stretto/issues/11/labels{/name}", "comments_url": "https://api.github.com/repos/al8n/stretto/issues/11/comments", "events_url": "https://api.github.com/repos/al8n/stretto/issues/11/events", "html_url": "https://github.com/al8n/stretto/pull/11", "id": 1194521189, "node_id": "PR_kwDOFz9ThM41urLG", "number": 11, "title": "feat: add non-panicking alternatives for cache methods that mutably borrow buckets", "user": {"login": "sebasmagri", "id": 11137, "node_id": "MDQ6VXNlcjExMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/11137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebasmagri", "html_url": "https://github.com/sebasmagri", "followers_url": "https://api.github.com/users/sebasmagri/followers", "following_url": "https://api.github.com/users/sebasmagri/following{/other_user}", "gists_url": "https://api.github.com/users/sebasmagri/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebasmagri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebasmagri/subscriptions", "organizations_url": "https://api.github.com/users/sebasmagri/orgs", "repos_url": "https://api.github.com/users/sebasmagri/repos", "events_url": "https://api.github.com/users/sebasmagri/events{/privacy}", "received_events_url": "https://api.github.com/users/sebasmagri/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-06T12:09:41Z", "updated_at": "2022-04-06T13:00:02Z", "closed_at": "2022-04-06T13:00:02Z", "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/al8n/stretto/pulls/11", "html_url": "https://github.com/al8n/stretto/pull/11", "diff_url": "https://github.com/al8n/stretto/pull/11.diff", "patch_url": "https://github.com/al8n/stretto/pull/11.patch", "merged_at": "2022-04-06T13:00:02Z"}, "body": "As the `.borrow_mut()` method on the `RwLock` used for the expiration map buckets\r\ncan panic when called and already borrowed, this change adds non-panicking\r\nalternatives to the caches' `update` and `insert*` methods prefixed by `try_`\r\nto make it possible for library users to handle the error.\r\n\r\nRelated to #10 ", "reactions": {"url": "https://api.github.com/repos/al8n/stretto/issues/11/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/al8n/stretto/issues/11/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/al8n/stretto/issues/7", "repository_url": "https://api.github.com/repos/al8n/stretto", "labels_url": "https://api.github.com/repos/al8n/stretto/issues/7/labels{/name}", "comments_url": "https://api.github.com/repos/al8n/stretto/issues/7/comments", "events_url": "https://api.github.com/repos/al8n/stretto/issues/7/events", "html_url": "https://github.com/al8n/stretto/pull/7", "id": 1083734436, "node_id": "PR_kwDOFz9ThM4wByhN", "number": 7, "title": "Update moka-rs/main in bench", "user": {"login": "tatsuya6502", "id": 159403, "node_id": "MDQ6VXNlcjE1OTQwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/159403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tatsuya6502", "html_url": "https://github.com/tatsuya6502", "followers_url": "https://api.github.com/users/tatsuya6502/followers", "following_url": "https://api.github.com/users/tatsuya6502/following{/other_user}", "gists_url": "https://api.github.com/users/tatsuya6502/gists{/gist_id}", "starred_url": "https://api.github.com/users/tatsuya6502/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tatsuya6502/subscriptions", "organizations_url": "https://api.github.com/users/tatsuya6502/orgs", "repos_url": "https://api.github.com/users/tatsuya6502/repos", "events_url": "https://api.github.com/users/tatsuya6502/events{/privacy}", "received_events_url": "https://api.github.com/users/tatsuya6502/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-18T03:24:19Z", "updated_at": "2021-12-18T09:28:05Z", "closed_at": "2021-12-18T09:27:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/al8n/stretto/pulls/7", "html_url": "https://github.com/al8n/stretto/pull/7", "diff_url": "https://github.com/al8n/stretto/pull/7.diff", "patch_url": "https://github.com/al8n/stretto/pull/7.patch", "merged_at": "2021-12-18T09:27:33Z"}, "body": "Hi. I just found Stretto. Very nice!\r\n\r\nThis PR updates the stuff in the `bench` directory:\r\n\r\n1. Fix compile errors in `bench/ristretto-rs/src/main.rs`.\r\n2. Update `bench/moka-rs/src/main.rs`:\r\n   - Show some statistics (hit, miss, gets total and hit ratio) at the end of run.\r\n   - Like Stretto and Ristretto, use precalculated hashes for keys, instead of calculating them at `get` and `insert` times.\r\n3. Ensure to clear `bench/bin` before building binaries and copying them into there. I found overriding binaries there somehow made them corrupted on my Mac. (Maybe due to an anti-virus software?)\r\n\r\nJust FYI, here is a benchmark result from my Mac:\r\n\r\n**Disclaimer**\r\n\r\n- I am the Moka author.\r\n- This is an apples-vs-oranges comparison as Moka v0.6.1 does not support cost-based eviction while others do.\r\n\r\n**Result**\r\n\r\n```console\r\n# macOS Big Sur (arm64), Apple M1 chip\r\n# Rust 1.57.0 stable\r\n\r\n$ ./bench.sh\r\n...\r\n\r\nGenerating mock data...\r\n---Go Ristretto Finished in 16ms---\r\nhit: 98690 miss: 24431 keys-added: 6763 keys-updated: 11565 keys-evicted: 5705 cost-added: 6243336 cost-evicted: 5243616 sets-dropped: 0 sets-rejected: 6103 gets-dropped: 21760 gets-kept: 101248 gets-total: 123121 hit-ratio: 0.80\r\n---Sync Stretto Finished in 18ms---\r\nMetrics::Op {\r\n  \"hit\": 96257,\r\n  \"miss\": 26864,\r\n  \"keys-added\": 26593,\r\n  \"keys-updated\": 262,\r\n  \"keys-evicted\": 25571,\r\n  \"cost-added\": 25817500,\r\n  \"cost-evicted\": 24817532,\r\n  \"sets-dropped\": 0,\r\n  \"sets-rejected\": 0,\r\n  \"gets-dropped\": 0,\r\n  \"gets-kept\": 0,\r\n  \"gets-total\": 123121,\r\n  \"hit-ratio\": 0.78\r\n}\r\n---Async Stretto Finished in 20ms---\r\nMetrics::Op {\r\n  \"hit\": 96758,\r\n  \"miss\": 26363,\r\n  \"keys-added\": 25897,\r\n  \"keys-updated\": 461,\r\n  \"keys-evicted\": 24863,\r\n  \"cost-added\": 25120192,\r\n  \"cost-evicted\": 24120308,\r\n  \"sets-dropped\": 0,\r\n  \"sets-rejected\": 0,\r\n  \"gets-dropped\": 0,\r\n  \"gets-kept\": 0,\r\n  \"gets-total\": 123121,\r\n  \"hit-ratio\": 0.79\r\n}\r\n---Sync Moka Finished in 19ms---\r\nOpMetrics { hit: 121825, miss: 1296, gets_total: 123121, hit_ratio: 0.99 }\r\n---Async Moka Finished in 19ms---\r\nOpMetrics { hit: 121825, miss: 1296, gets_total: 123121, hit_ratio: 0.99 }\r\n```\r\n\r\n**Some thoughts:**\r\n\r\n- Moka's hit ratio is somewhat higher than others (0.99 vs 0.79, 0.80).\r\n    - This might be caused by the difference in cache admission policies:\r\n        - Stretto and Ristretto use a write buffer and while entries are in the buffer, `get` will not return them. (cache miss)\r\n        - Moka uses a write buffer too but while entries are in the buffer, `get` will return them. (cache hit)\r\n    - You might want to adjust the key distribution in the dataset to reduce the hit ratio in Moka.\r\n", "reactions": {"url": "https://api.github.com/repos/al8n/stretto/issues/7/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/al8n/stretto/issues/7/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/al8n/stretto/issues/6", "repository_url": "https://api.github.com/repos/al8n/stretto", "labels_url": "https://api.github.com/repos/al8n/stretto/issues/6/labels{/name}", "comments_url": "https://api.github.com/repos/al8n/stretto/issues/6/comments", "events_url": "https://api.github.com/repos/al8n/stretto/issues/6/events", "html_url": "https://github.com/al8n/stretto/pull/6", "id": 1083548969, "node_id": "PR_kwDOFz9ThM4wBMWY", "number": 6, "title": "Heap optimization for removing min sample", "user": {"login": "palashahuja", "id": 8504351, "node_id": "MDQ6VXNlcjg1MDQzNTE=", "avatar_url": "https://avatars.githubusercontent.com/u/8504351?v=4", "gravatar_id": "", "url": "https://api.github.com/users/palashahuja", "html_url": "https://github.com/palashahuja", "followers_url": "https://api.github.com/users/palashahuja/followers", "following_url": "https://api.github.com/users/palashahuja/following{/other_user}", "gists_url": "https://api.github.com/users/palashahuja/gists{/gist_id}", "starred_url": "https://api.github.com/users/palashahuja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/palashahuja/subscriptions", "organizations_url": "https://api.github.com/users/palashahuja/orgs", "repos_url": "https://api.github.com/users/palashahuja/repos", "events_url": "https://api.github.com/users/palashahuja/events{/privacy}", "received_events_url": "https://api.github.com/users/palashahuja/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-17T19:14:39Z", "updated_at": "2021-12-18T09:22:14Z", "closed_at": "2021-12-18T09:22:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/al8n/stretto/pulls/6", "html_url": "https://github.com/al8n/stretto/pull/6", "diff_url": "https://github.com/al8n/stretto/pull/6.diff", "patch_url": "https://github.com/al8n/stretto/pull/6.patch", "merged_at": "2021-12-18T09:22:14Z"}, "body": "Currently, there was a TODO for finding the sample with min_hits, which is currently done by iterating through the samples. This PR optimizes by using a binary heap. ", "reactions": {"url": "https://api.github.com/repos/al8n/stretto/issues/6/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/al8n/stretto/issues/6/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/al8n/stretto/issues/5", "repository_url": "https://api.github.com/repos/al8n/stretto", "labels_url": "https://api.github.com/repos/al8n/stretto/issues/5/labels{/name}", "comments_url": "https://api.github.com/repos/al8n/stretto/issues/5/comments", "events_url": "https://api.github.com/repos/al8n/stretto/issues/5/events", "html_url": "https://github.com/al8n/stretto/pull/5", "id": 1068845462, "node_id": "PR_kwDOFz9ThM4vRZjb", "number": 5, "title": "get benches running again", "user": {"login": "bddap", "id": 2702854, "node_id": "MDQ6VXNlcjI3MDI4NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2702854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bddap", "html_url": "https://github.com/bddap", "followers_url": "https://api.github.com/users/bddap/followers", "following_url": "https://api.github.com/users/bddap/following{/other_user}", "gists_url": "https://api.github.com/users/bddap/gists{/gist_id}", "starred_url": "https://api.github.com/users/bddap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bddap/subscriptions", "organizations_url": "https://api.github.com/users/bddap/orgs", "repos_url": "https://api.github.com/users/bddap/repos", "events_url": "https://api.github.com/users/bddap/events{/privacy}", "received_events_url": "https://api.github.com/users/bddap/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-01T20:34:22Z", "updated_at": "2021-12-02T18:35:27Z", "closed_at": "2021-12-02T03:47:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/al8n/stretto/pulls/5", "html_url": "https://github.com/al8n/stretto/pull/5", "diff_url": "https://github.com/al8n/stretto/pull/5.diff", "patch_url": "https://github.com/al8n/stretto/pull/5.patch", "merged_at": "2021-12-02T03:47:13Z"}, "body": "`cd benches && ./bench.sh` was failing previously. This pr gets it working again.", "reactions": {"url": "https://api.github.com/repos/al8n/stretto/issues/5/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/al8n/stretto/issues/5/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]