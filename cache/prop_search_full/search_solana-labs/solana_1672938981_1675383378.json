[{"url": "https://api.github.com/repos/solana-labs/solana/issues/29195", "repository_url": "https://api.github.com/repos/solana-labs/solana", "labels_url": "https://api.github.com/repos/solana-labs/solana/issues/29195/labels{/name}", "comments_url": "https://api.github.com/repos/solana-labs/solana/issues/29195/comments", "events_url": "https://api.github.com/repos/solana-labs/solana/issues/29195/events", "html_url": "https://github.com/solana-labs/solana/pull/29195", "id": 1488133825, "node_id": "PR_kwDOBz19r85E-4cw", "number": 29195, "title": "fix: [web3] only ever send RPC socket messages when the socket is open", "user": {"login": "steveluscher", "id": 13243, "node_id": "MDQ6VXNlcjEzMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/13243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveluscher", "html_url": "https://github.com/steveluscher", "followers_url": "https://api.github.com/users/steveluscher/followers", "following_url": "https://api.github.com/users/steveluscher/following{/other_user}", "gists_url": "https://api.github.com/users/steveluscher/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveluscher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveluscher/subscriptions", "organizations_url": "https://api.github.com/users/steveluscher/orgs", "repos_url": "https://api.github.com/users/steveluscher/repos", "events_url": "https://api.github.com/users/steveluscher/events{/privacy}", "received_events_url": "https://api.github.com/users/steveluscher/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4856115516, "node_id": "LA_kwDOBz19r88AAAABIXJxPA", "url": "https://api.github.com/repos/solana-labs/solana/labels/web3.js", "name": "web3.js", "color": "09DCD7", "default": false, "description": "Related to the JavaScript client"}], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/solana-labs/solana/milestones/204", "html_url": "https://github.com/solana-labs/solana/milestone/204", "labels_url": "https://api.github.com/repos/solana-labs/solana/milestones/204/labels", "id": 8808461, "node_id": "MI_kwDOBz19r84AhmgN", "number": 204, "title": "web3.js Roadmap \u2013 January 2023", "description": "Let's use this milestone as a way to call out where we hope to take web3.js in the month of January. At the end, we can review how far we got.\r\n\r\nThis is a way for the community to see into our mental todo list. If you see something here that you don't think is worth doing, or something that's missing that's important to you, file a GitHub issue or start a discussion in #29444.", "creator": {"login": "steveluscher", "id": 13243, "node_id": "MDQ6VXNlcjEzMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/13243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveluscher", "html_url": "https://github.com/steveluscher", "followers_url": "https://api.github.com/users/steveluscher/followers", "following_url": "https://api.github.com/users/steveluscher/following{/other_user}", "gists_url": "https://api.github.com/users/steveluscher/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveluscher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveluscher/subscriptions", "organizations_url": "https://api.github.com/users/steveluscher/orgs", "repos_url": "https://api.github.com/users/steveluscher/repos", "events_url": "https://api.github.com/users/steveluscher/events{/privacy}", "received_events_url": "https://api.github.com/users/steveluscher/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 3, "state": "closed", "created_at": "2022-12-30T16:05:14Z", "updated_at": "2023-02-02T00:34:39Z", "due_on": "2023-01-31T00:00:00Z", "closed_at": "2023-02-02T00:09:58Z"}, "comments": 10, "created_at": "2022-12-10T07:17:39Z", "updated_at": "2023-02-23T07:47:03Z", "closed_at": "2023-01-31T17:03:41Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/solana-labs/solana/pulls/29195", "html_url": "https://github.com/solana-labs/solana/pull/29195", "diff_url": "https://github.com/solana-labs/solana/pull/29195.diff", "patch_url": "https://github.com/solana-labs/solana/pull/29195.patch", "merged_at": "2023-01-31T17:03:41Z"}, "body": "#### Problem\r\n\r\nOur `rpc-websockets` dependency does not guard against the underlying socket not being `OPEN` before it tries to call `send()` on the socket itself.\r\n\r\n* When the `readyState` of a socket is `CONNECTING` and you try to call `send()`, it will fatal.\r\n* When the `readyState` of a socket is `CLOSING` or `CLOSED` and you try to call `send()`, it will discard the call silently. A console error results sometime later, but in no event does it fatal your program.\r\n\r\nAll of this can lead to corruption of the internal state of the RPC; it can think that it's connected, able to send messages, and is owed responses, when it is not.\r\n\r\n#### Summary of Changes\r\n\r\n* Subclass `rpc-websockets` and wrap the `call()` and `notify()` methods in code that checks the `readyState` before trying to call `send()`.\r\n\r\nFixes solana-labs/solana#25578, solana-labs/solana#27167, solana-labs/solana-web3.js#1106.", "reactions": {"url": "https://api.github.com/repos/solana-labs/solana/issues/29195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/solana-labs/solana/issues/29195/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]