[{"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23", "repository_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs", "labels_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23/labels{/name}", "comments_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23/comments", "events_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23/events", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/23", "id": 974622108, "node_id": "MDExOlB1bGxSZXF1ZXN0NzE1ODk5MzA1", "number": 23, "title": "ci: replace travis with GH actions", "user": {"login": "ernestas-vinted", "id": 7201930, "node_id": "MDQ6VXNlcjcyMDE5MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/7201930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ernestas-vinted", "html_url": "https://github.com/ernestas-vinted", "followers_url": "https://api.github.com/users/ernestas-vinted/followers", "following_url": "https://api.github.com/users/ernestas-vinted/following{/other_user}", "gists_url": "https://api.github.com/users/ernestas-vinted/gists{/gist_id}", "starred_url": "https://api.github.com/users/ernestas-vinted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ernestas-vinted/subscriptions", "organizations_url": "https://api.github.com/users/ernestas-vinted/orgs", "repos_url": "https://api.github.com/users/ernestas-vinted/repos", "events_url": "https://api.github.com/users/ernestas-vinted/events{/privacy}", "received_events_url": "https://api.github.com/users/ernestas-vinted/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-19T12:41:41Z", "updated_at": "2021-08-19T12:47:47Z", "closed_at": "2021-08-19T12:47:45Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/pulls/23", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/23", "diff_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/23.diff", "patch_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/23.patch", "merged_at": "2021-08-19T12:47:45Z"}, "body": null, "reactions": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/23/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22", "repository_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs", "labels_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22/labels{/name}", "comments_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22/comments", "events_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22/events", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/22", "id": 970493581, "node_id": "MDExOlB1bGxSZXF1ZXN0NzEyNDM4MjY2", "number": 22, "title": "lifetime: implement automatic metrics deletion", "user": {"login": "ernestas-vinted", "id": 7201930, "node_id": "MDQ6VXNlcjcyMDE5MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/7201930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ernestas-vinted", "html_url": "https://github.com/ernestas-vinted", "followers_url": "https://api.github.com/users/ernestas-vinted/followers", "following_url": "https://api.github.com/users/ernestas-vinted/following{/other_user}", "gists_url": "https://api.github.com/users/ernestas-vinted/gists{/gist_id}", "starred_url": "https://api.github.com/users/ernestas-vinted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ernestas-vinted/subscriptions", "organizations_url": "https://api.github.com/users/ernestas-vinted/orgs", "repos_url": "https://api.github.com/users/ernestas-vinted/repos", "events_url": "https://api.github.com/users/ernestas-vinted/events{/privacy}", "received_events_url": "https://api.github.com/users/ernestas-vinted/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-13T15:17:33Z", "updated_at": "2021-08-16T07:52:08Z", "closed_at": "2021-08-16T07:52:06Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/pulls/22", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/22", "diff_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/22.diff", "patch_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/22.patch", "merged_at": "2021-08-16T07:52:05Z"}, "body": "The problem with ephemeral entities such as Index and Node makes exporter export stale metrics.\r\nThis change introduces concept of a lifetime for metric values. \r\nWhen lifetime is defined, e.g. cat_indices: 180seconds all metric labels will be exported at most for 180seconds since last recording. \r\n\r\nFlow, assuming \"bam\" index created and deleted.\r\n\r\n```\r\n$ curl -s http://localhost:9222/metrics | wc -l\r\n449\r\n\r\n$ curl -XPUT localhost:9200/bam\r\n{\"acknowledged\":true,\"shards_acknowledged\":true,\"index\":\"bam\"}\r\n\r\n$ curl -s http://localhost:9222/metrics | wc -l\r\n526\r\n\r\n$ curl -XDELETE localhost:9200/bam\r\n{\"acknowledged\":true}\r\n\r\n$ curl -s http://localhost:9222/metrics | wc -l\r\n449\r\n```\r\n\r\n1. Checking metrics we have 449 total\r\n2. After creating index there were 526 metrics\r\n3. After deleting index count is back to previous\r\n\r\nDebug log\r\n\r\n```\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: pri_segments_fixed_bitset_memory labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: merges_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: memory_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: refresh_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: warmer_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: pri_search_scroll_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: pri_merges_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: docs_deleted labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: segments_fixed_bitset_memory labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: pri_fielddata_memory_size labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: segments_memory labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: pri_search_fetch_total labels: [\"bam\"]\r\n DEBUG elasticsearch_exporter::metrics::_cat::indices > REMOVING `cat_indices` stale metric: flush_total labels: [\"bam\"]\r\n\r\n```\r\n", "reactions": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/22/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21", "repository_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs", "labels_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21/labels{/name}", "comments_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21/comments", "events_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21/events", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/21", "id": 968305377, "node_id": "MDExOlB1bGxSZXF1ZXN0NzEwNDMwNjIw", "number": 21, "title": "metadata: implement indices refresh", "user": {"login": "ernestas-vinted", "id": 7201930, "node_id": "MDQ6VXNlcjcyMDE5MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/7201930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ernestas-vinted", "html_url": "https://github.com/ernestas-vinted", "followers_url": "https://api.github.com/users/ernestas-vinted/followers", "following_url": "https://api.github.com/users/ernestas-vinted/following{/other_user}", "gists_url": "https://api.github.com/users/ernestas-vinted/gists{/gist_id}", "starred_url": "https://api.github.com/users/ernestas-vinted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ernestas-vinted/subscriptions", "organizations_url": "https://api.github.com/users/ernestas-vinted/orgs", "repos_url": "https://api.github.com/users/ernestas-vinted/repos", "events_url": "https://api.github.com/users/ernestas-vinted/events{/privacy}", "received_events_url": "https://api.github.com/users/ernestas-vinted/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-08-12T08:04:42Z", "updated_at": "2021-08-13T07:36:39Z", "closed_at": "2021-08-13T07:36:37Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/pulls/21", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/21", "diff_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/21.diff", "patch_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/21.patch", "merged_at": "2021-08-13T07:36:37Z"}, "body": "Fetch `/_cat/indices` endpoint to record the time when was the last time index was present. Heartbeat of a index will help to distinguish deleted indices which in turn will enable to delete stale metrics. ", "reactions": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/21/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}, {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20", "repository_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs", "labels_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20/labels{/name}", "comments_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20/comments", "events_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20/events", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/20", "id": 967118714, "node_id": "MDExOlB1bGxSZXF1ZXN0NzA5MzEyMzA2", "number": 20, "title": "metrics: implement stats", "user": {"login": "ernestas-vinted", "id": 7201930, "node_id": "MDQ6VXNlcjcyMDE5MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/7201930?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ernestas-vinted", "html_url": "https://github.com/ernestas-vinted", "followers_url": "https://api.github.com/users/ernestas-vinted/followers", "following_url": "https://api.github.com/users/ernestas-vinted/following{/other_user}", "gists_url": "https://api.github.com/users/ernestas-vinted/gists{/gist_id}", "starred_url": "https://api.github.com/users/ernestas-vinted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ernestas-vinted/subscriptions", "organizations_url": "https://api.github.com/users/ernestas-vinted/orgs", "repos_url": "https://api.github.com/users/ernestas-vinted/repos", "events_url": "https://api.github.com/users/ernestas-vinted/events{/privacy}", "received_events_url": "https://api.github.com/users/ernestas-vinted/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-08-11T17:22:53Z", "updated_at": "2021-08-12T07:57:20Z", "closed_at": "2021-08-12T07:57:18Z", "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/pulls/20", "html_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/20", "diff_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/20.diff", "patch_url": "https://github.com/vinted/elasticsearch-exporter-rs/pull/20.patch", "merged_at": "2021-08-12T07:57:18Z"}, "body": "Implemented not enabled /_stats metrics endpoint and enable it by default \r\n", "reactions": {"url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vinted/elasticsearch-exporter-rs/issues/20/timeline", "performed_via_github_app": null, "state_reason": null, "score": 1.0}]